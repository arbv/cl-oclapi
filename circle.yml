machine:
    environment:
        LISP: sbcl-bin
        PATH: ~/.roswell/bin:$PATH
        CXX: clang++
        POCL: pocl-0.12

checkout:
    pre:
        - curl -L https://raw.githubusercontent.com/snmsts/roswell/master/scripts/install-for-ci.sh | sh

dependencies:
    pre:
        - sudo apt-get install -y pkg-config libltdl3-dev libhwloc-dev llvm-dev clang libclang-dev ocl-icd-opencl-dev libedit-dev
        - if [ ! -d ${POCL} ]; then wget http://portablecl.org/downloads/${POCL}.tar.gz; fi
        - if [ ! -d ${POCL} ]; then tar xzf ${POCL}.tar.gz && cd ${POCL}/ && ./configure && make && sudo make install; fi

        - ros install prove

    cache_directories:
        - ~/.roswell/
        - ~/${POCL}/

test:
    override:
        - ros run -- --version
        - run-prove *-test.asd
